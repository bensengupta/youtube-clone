<h1 class=\"
\">Upload a video</h1><form id=\"upload-form\"><label for=\"file\">Choose a file</label> <input type=\"file\" name=\"file\" id=\"file\"><p id=\"error\" class=\"hidden\"></p><button>Upload</button> <progress id=\"progress\" value=\"0\" max=\"100\"></progress></form><script>\n        function onProgress(event) {\n            const progress = document.getElementById('progress');\n            progress.value = event.loaded / event.total * 100;\n        }\n\n        async function onFormSubmit(event) {\n            event.preventDefault();\n            const file = document.querySelector('input[type=file]').files[0];\n\n            const response = await fetch(window.location.href, {\n                method: 'PUT',\n                body: JSON.stringify({ fileSize: file.size, contentType: file.type }),\n            });\n\n            if (!response.ok) {\n                const body = await response.text();\n                const errorParagraph = document.getElementById('error');\n                errorParagraph.textContent = body;\n                errorParagraph.classList.remove('hidden');\n                return;\n            }\n\n            const { presignedUrl, callbackPath } = await response.json();\n            const xhr = new XMLHttpRequest();\n            const uploadPromise = Promise.withResolvers();\n            xhr.upload.addEventListener('progress', onProgress);\n            xhr.onload = () => uploadPromise.resolve();\n            xhr.onerror = () => uploadPromise.reject();\n            xhr.open('PUT', presignedUrl);\n            xhr.send(file);\n\n            await uploadPromise.promise;\n\n            if (xhr.status !== 200) {\n                const errorParagraph = document.getElementById('error');\n                errorParagraph.textContent = xhr.responseText;\n                errorParagraph.classList.remove('hidden');\n                return;\n            }\n\n            window.location.href = callbackPath;\n        }\n        document.getElementById('upload-form').addEventListener('submit', onFormSubmit);\n        </script>